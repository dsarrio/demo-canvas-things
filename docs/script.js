Ms=Math.sin;Mc=Math.cos;Mp=Math.pow;Mm=Math.min;
var Co=a=>{const b=a.getContext("2d");b.W=a.width;b.H=a.height;return b},Ca=(a,b)=>{const c=document.createElement("canvas");c.width=a;c.height=b;return c},clamp=(a,b,c)=>a<b?b:a>c?c:a,saturate=a=>clamp(a,0,1),lerp=(a,b,c)=>a+c*(b-a),tlerp=(a,b,c,d,e)=>{a=a!=b?clamp((e-a)/(b-a),0,1):1;return lerp(c,d,a*a*(3-2*a))},easeinout=a=>.5>a?16*a*a*a*a*a:1-Mp(-2*a+2,5)/2,easein=a=>Mp(a,3),easeout=a=>1-Mp(1-a,3),easeoutsine=a=>Ms(a*Math.PI/2),bounce=a=>1-4*Mp(a-.5,2),noise2D=(a,b)=>{a=P(a,b);return 43758.5453*
Ms(V2.dot(a,P(12.9898,78.233)))%1},rgba=(a,b,c,d)=>{a=clamp(Math.round(255*a),0,255);b=clamp(Math.round(255*b),0,255);c=clamp(Math.round(255*c),0,255);return"rgba("+a+","+b+","+c+","+d+")"},randBetween=(a,b)=>a+Math.random()*(b-a),randIntBetween=(a,b)=>Math.round(randBetween(a,b)),hsv2hsl=a=>{const b=Math.round(a.h),c=a.v-a.v*a.s/2,d=Mm(c,1-c);return"hsl("+b+","+Math.round(100*(d?(a.v-c)/d:0))+"%,"+Math.round(100*c)+"%)"},randColor=()=>"rgb("+255*Math.random()+","+255*Math.random()+","+255*Math.random()+
")",P=(a,b,c=0,d=1)=>({x:a,y:b,z:c,w:d});
const V2={normalized({x:a,y:b}){const c=Math.sqrt(a*a+b*b);return{x:a/c,y:b/c}},direction(a,b){const c=b.x-a.x;a=b.y-a.y;b=Math.sqrt(c*c+a*a);return{x:c/b,y:a/b}},rotated(a,b){const c=Ms(b);b=Mc(b);return P(a.x*b-a.y*c,a.x*c+a.y*b)},dot(a,b){return a.x*b.x+a.y*b.y},lerp(a,b,c){return P(lerp(a.x,b.x,c),lerp(a.y,b.y,c))}},V3={lengthSquared({x:a,y:b,z:c}){return a*a+b*b+c*c},length({x:a,y:b,z:c}){return Math.sqrt(a*a+b*b+c*c)},mult(a,b){return P(a.x*b,a.y*b,a.z*b)},add(a,b){return P(a.x+b.x,a.y+b.y,
a.z+b.z)},minus(a,b){return P(a.x-b.x,a.y-b.y,a.z-b.z)},normalized({x:a,y:b,z:c}){const d=Math.sqrt(a*a+b*b+c*c);return{x:a/d,y:b/d,z:c/d}},mat_mult(a,b){return P(a.x*b[0]+a.y*b[4]+a.z*b[8]+a.w*b[12],a.x*b[1]+a.y*b[5]+a.z*b[9]+a.w*b[13],a.x*b[2]+a.y*b[6]+a.z*b[10]+a.w*b[14],a.x*b[3]+a.y*b[7]+a.z*b[11]+a.w*b[15])},cross(a,b){return P(a.y*b.z-a.z*b.y,a.z*b.x-a.x*b.z,a.x*b.y-a.y*b.x)},dot(a,b){return a.x*b.x+a.y*b.y+a.z*b.z},lerp(a,b,c){return P(a.x+(b.x-a.x)*c,a.y+(b.y-a.y)*c,a.z+(b.z-a.z)*c)}};
var step=(a,b,c)=>saturate((c-a)/(b-a));
const M4={identity(){const a=new Float32Array(16);a[0]=1;a[5]=1;a[10]=1;a[15]=1;return a},frustum(a,b,c,d){const e=new Float32Array(16);a=Math.tan(.5*a*Math.PI/180)*c;b*=a;const f=-b,g=-a;e[0]=2*c/(b-f);e[1]=0;e[2]=0;e[3]=0;e[4]=0;e[5]=2*c/(a-g);e[6]=0;e[7]=0;e[8]=(b+f)/(b-f);e[9]=(a+g)/(a-g);e[10]=-(d+c)/(d-c);e[11]=-1;e[12]=0;e[13]=0;e[14]=-2*d*c/(d-c);e[15]=0;return e},lookAt(a,b,c){const d=new Float32Array(16);b=V3.normalized(P(a.x-b.x,a.y-b.y,a.z-b.z));c=V3.normalized(V3.cross(c,b));var e=V3.cross(b,
c);d[0]=c.x;d[1]=e.x;d[2]=b.x;d[3]=0;d[4]=c.y;d[5]=e.y;d[6]=b.y;d[7]=0;d[8]=c.z;d[9]=e.z;d[10]=b.z;d[11]=0;d[12]=-V3.dot(c,a);d[13]=-V3.dot(e,a);d[14]=-V3.dot(b,a);d[15]=1;return d},multiply(a,b){const c=new Float32Array(16);var d=a[0],e=a[1],f=a[2],g=a[3];c[0]=d*b[0]+e*b[4]+f*b[8]+g*b[12];c[1]=d*b[1]+e*b[5]+f*b[9]+g*b[13];c[2]=d*b[2]+e*b[6]+f*b[10]+g*b[14];c[3]=d*b[3]+e*b[7]+f*b[11]+g*b[15];d=a[4];e=a[5];f=a[6];g=a[7];c[4]=d*b[0]+e*b[4]+f*b[8]+g*b[12];c[5]=d*b[1]+e*b[5]+f*b[9]+g*b[13];c[6]=d*b[2]+
e*b[6]+f*b[10]+g*b[14];c[7]=d*b[3]+e*b[7]+f*b[11]+g*b[15];d=a[8];e=a[9];f=a[10];g=a[11];c[8]=d*b[0]+e*b[4]+f*b[8]+g*b[12];c[9]=d*b[1]+e*b[5]+f*b[9]+g*b[13];c[10]=d*b[2]+e*b[6]+f*b[10]+g*b[14];c[11]=d*b[3]+e*b[7]+f*b[11]+g*b[15];d=a[12];e=a[13];f=a[14];g=a[15];c[12]=d*b[0]+e*b[4]+f*b[8]+g*b[12];c[13]=d*b[1]+e*b[5]+f*b[9]+g*b[13];c[14]=d*b[2]+e*b[6]+f*b[10]+g*b[14];c[15]=d*b[3]+e*b[7]+f*b[11]+g*b[15];return c},rotationX(a){const b=new Float32Array(16);var c=Mc(a);a=Ms(a);b[0]=1;b[1]=0;b[2]=0;b[3]=0;
b[4]=0;b[5]=c;b[6]=a;b[7]=0;b[8]=0;b[9]=-a;b[10]=c;b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return b},rotationZ(a){const b=new Float32Array(16);var c=Mc(a);a=Ms(a);b[0]=c;b[1]=a;b[2]=0;b[3]=0;b[4]=-a;b[5]=c;b[6]=0;b[7]=0;b[8]=0;b[9]=0;b[10]=1;b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return b}};
var cellnoise=a=>{a=Math.floor(a)|0;let b=a=(a<<13^a)&4294967295;a=((15731*a&4294967295)*b&4294967295)+789221;a&=4294967295;a=(a*b&4294967295)+1376312589;a&=4294967295;a=a>>14&65535;return a/65535},noise1D=a=>{var b=Math.floor(a)|0;const c=a-b;a=c*c*c*(c*(6*c-15)+10);const d=(2*cellnoise(b+0)-1)*(c+0);b=(2*cellnoise(b+1)-1)*(c-1);return 2*(d+(b-d)*a)},bumpy=a=>.5*Ms(2*a*Math.PI-Math.PI/2)+.5,song={songData:[{i:[2,49,128,0,3,162,128,0,0,0,5,6,58,0,0,0,0,195,6,1,2,135,0,2,24,147,6,121,6],p:[,1,2,2,
2,2,2,2,3,4,,,,,,,,,,,,,,,,5,6,7,7,7,7,7,7,,,,,,,,,,,,,,,,8],c:[{n:[,,,,,,,,,139,142,146,147,146,142,139,135,139,142,146,147,146,142,139,135,139,142,146,147,146,142,139],f:[,,,,,,,,,6,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,162]},{n:[135,139,142,146,147,146,142,139,135,139,142,146,147,146,142,139,135,139,142,146,147,146,142,139,135,139,142,146,147,146,142,139],f:[]},{n:[135,139,142,146,147,146,142,139,135,139,142,146,147,146,130,127,122,127,130,134,135,134,130,127,122,127,130,134,135,134,130,127],f:[]},{n:[122,
127,130,134,135,134,130,127,122,127,130,134,135,134,130,127,122,127,130,134,135,134,130,127,122,127,130,134,135,134],f:[2,6,2,6,2,6,2,6,2,6,2,6,2,6,2,6,2,6,2,6,2,6,2,6,2,,,,,,2,6,49,178,45,162,41,144,37,130,33,112,29,95,25,77,21,61,17,45,13,29,9,12,5,,,,,,,,194,195]},{n:[,,,,,,,,115,,,,,,,,115,,,,,,,,115],f:[6,2,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,93,49]},{n:[115,,103,,,,,,115,,103,,,,,,115,,103,,,,,,115,,103],f:[]},{n:[103,,115,,,,115,,103,,115,,,,115,,103,,115,,,,115,,103,,115,,,,115],f:[]},{n:[,,,,,
,,,,,,,,148],f:[]}]},{i:[1,195,128,0,1,128,128,9,0,0,7,11,211,96,0,0,0,0,0,0,2,8,15,1,29,47,0,0,0],p:[,,2,3,4,1],c:[{n:[,137,,,123,,,,122],f:[]},{n:[,,,,,,,,,,,,,,,,,,110],f:[]},{n:[106,,,,110,,,,,,,,,,,,,,,,,,,,,,110],f:[]},{n:[,,,,,,,,,,,,,101,,,,111],f:[]}]},{i:[0,255,116,79,0,255,116,0,83,0,4,6,69,52,0,0,0,0,0,0,2,14,0,0,32,0,0,0,0],p:[1,2,2,2,2,2,2,2,2,2],c:[{n:[,,,,,,,,,,,,,,,,,,,,,,,,,,,,127,127],f:[]},{n:[127,127,,,127,127,,,127,127,,,127,127,,,127,127,,,127,127,,,127,127,,,127,127],f:[]}]},
{i:[2,159,128,0,3,201,128,4,0,0,0,21,33,0,0,0,2,232,3,1,3,50,210,149,244,156,6,123,6],p:[,,,,,,,,,,,,,,,,,,,,,,,,,,,,5,1,1,2,3,3,3,1,1,2,3,3,3,4],c:[{n:[103,,115,,103,,115,,103,,115,,103,,115,,103,,115,,103,,115,,103,,115,,103,,115],f:[]},{n:[115,,127,,115,,127,,115,,127,,115,,127,,115,,127,,115,135,127,135,115,135,127,135,115,135,127,135],f:[]},{n:[137,137,137,127,127,127,137,137,137,127,127,127,137,127,137,137,137,127,137,137,137,127,137,137,137,127,137,137,137,127,137,127],f:[]},{n:[137,137,137,
127,127,127,137,137,137,127,127],f:[]},{n:[,,,,,,,,,,,,,,,,103,,115,,103,,115,,103,,115,,103,,115],f:[]}]},{i:[0,73,128,0,0,65,128,2,0,0,37,4,113,0,0,0,0,95,7,1,3,18,36,0,32,51,5,24,5],p:[,,,,,,,,,,,,,,,,,,2,3,4,4,1],c:[{n:[111,,123,,127,,130,,106],f:[]},{n:[135,,147,,151,,154,,134,,146,,149,,154,,130,,142,,146,,151,,125,,137,,140,,144],f:[]},{n:[135,,147,,151,,154,,134,,139,,142,,147,,134,,146,,149,,154,,127,,139,,142,,147],f:[]},{n:[123,,135,,139,,142,,122,,134,,137,,142,,118,,130,,134,,139,,113,
,125,,128,,132,,147,,,,163,,,,146,,,,166,,,,142,,,,158,,,,137,,,,152],f:[]}]},{i:[2,100,128,0,3,201,128,5,0,0,5,6,58,0,0,0,0,195,6,1,3,30,0,2,44,147,6,121,6],p:[,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,1,1,1,1,1,2],c:[{n:[140,,142,,146,,147,,154,,156,,152,,149,,147,,142,,144,,140,,137,,144,,151,,135],f:[]},{n:[140,,142,,146,,147,,154,,156],f:[]}]},{i:[0,255,119,240,3,255,109,0,117,0,0,0,96,0,0,0,0,0,0,0,2,14,32,8,72,0,0,0,0],p:[,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,1,1,1,1,1,2],c:[{n:[135,135,,,135,,,
,135,135,,,135,,,,135,135,,,135,,,,135,135,,,135],f:[]},{n:[135,135,,,135,,,,135,135],f:[]}]},{i:[0,255,106,64,0,255,106,0,64,0,5,7,164,0,0,0,0,0,0,0,2,255,0,2,32,83,5,25,1],p:[],c:[]},{i:[0,104,152,0,0,147,152,12,0,0,2,0,60,0,0,0,0,0,0,0,2,255,0,0,32,47,3,157,2],p:[,,,,,,,,,,1,1,2,3,4,5,6],c:[{n:[120,,,,,,,,122,,,,,,,,125,,,,123,,,,120,,,,118],f:[]},{n:[118,,,,118,,,,118,,116,,115,,118,,116,,122,,122,,125,,116,123,127,122,118,115,111],f:[]},{n:[,,132,132,132,132,132,134,135,130,130,,,,,,,,,,,,,,
132,,123,,122,,123],f:[]},{n:[122,,125,,128,,127,,125,,127,,,,,,132,132,132,132,132,134,135,130,130,,,,,144,,135],f:[]},{n:[,134,,137,,140,,139,,137,,139,,,,,,,,,132,,,,123,,,,122],f:[]},{n:[123,,,,134,,,,137,,,,139,,,,137,,,,135,132,132,132,132,132,130,128,125],f:[]}]},{i:[0,0,140,0,0,0,140,0,0,81,4,10,47,55,0,0,0,187,5,0,1,239,135,0,32,108,5,16,4],p:[,,,,,,,,,,,,,1,1,1,2,,,,,,,,,,,,,,1,1,1,,,,1,1,1,1,1,3],c:[{n:[140,140,,,140,,,,140,140,,,140,,,,140,140,,,140,,,,140,140,,,140],f:[]},{n:[,,,,140,
,,,,,,,140],f:[]},{n:[140,140,,,140,,,,140,140],f:[]}]},{i:[2,192,128,0,2,192,140,18,0,0,116,85,116,0,0,0,0,0,0,0,2,5,0,0,32,0,0,24,8],p:[,,,,,1,2,5,,,,,,3,4,,,,,,,,,,,,,,,,,,,,6,6,6,6,6,6,6],c:[{n:[,,,,,,,,,,,,,,,,115,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,115],f:[]},{n:[125,,,,,,,,,,,,,,,,108,,,,,,,,,,,,,,,,,125,,,,,,,,,,,,,,,,108],f:[]},{n:[,,147,,,,,,,,,,,,,,,,,,,,,,144],f:[]},{n:[,,,,,,,,,,,,,,,,,,,,,,,,,,,,,149],f:[]},{n:[,,,,104,,,,,,,,,,,,,,,,,,,,99,,,,,,,,,,,,,104,,,,,,,,,,,,,,,,,,,,99],f:[]},{n:[,
,,,,,,,,,,,,,,,,,,,,,,,127],f:[]}]},{i:[2,40,140,64,0,0,140,0,0,255,0,0,67,104,0,0,0,0,0,0,3,161,192,0,32,0,0,0,0],p:[,,,,,,,,,,,,,1,1,1,1,,,,,,2,3,3,3,3,3,4,,3,3,3,,,,,,,,,,5,6,7,8],c:[{n:[132,,,,,,,,132],f:[10,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,255]},{n:[,,,,,,,,,,,,,,,,,,,,,,,,127],f:[,,,,,,,,,,,,,,,,,,,,,,,,11,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,33]},{n:[127,,,,,,,,127,,,,,,,,127,,,,,,,,127],f:[10,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,143]},{n:[127,,,,,,,,127],f:[]},{n:[,,,,,,,,,,,,,,,,,,,,135,135,135,135,135,
135,135],f:[,,,,,,,,,,,,,,,,,,,,11]},{n:[,,,,,,,,,,,,,,,,,,,,,,,135,135,135,135,135,135,135,135,135,,,,,,,,,,,,,,,,,,,,,,,,,,,135],f:[]},{n:[135,135,,,,,,,,,,,,,,,,,,,,,,,,,135,,135,135,135,135],f:[]},{n:[135,135,135,135,135],f:[]}]},{i:[2,100,128,0,3,201,128,0,0,0,5,6,58,0,0,0,0,195,6,1,2,135,0,0,32,147,6,121,6],p:[],c:[]},{i:[0,0,140,0,0,0,140,0,0,44,158,158,158,0,0,0,0,51,2,1,2,58,239,67,32,88,1,157,2],p:[,,,,,,,,,,,,,,,,,1,2,3,,4],c:[{n:[,,,,135],f:[]},{n:[,,,,,,,,,,,,,,,,,,,,176],f:[]},{n:[,
,,,,,,,,,,,,,,,,,,,,,,,135],f:[]},{n:[176],f:[]}]},{i:[0,214,104,64,0,204,104,0,64,229,4,40,43,51,0,0,0,231,6,1,3,183,15,0,32,232,4,74,6],p:[,,,,,,,,,,,,,,,1],c:[{n:[,,,,,,,,,,,128],f:[]}]},{i:[0,0,92,0,0,0,92,0,0,255,28,211,0,0,0,0,0,0,0,0,1,0,0,0,17,0,0,0,0],p:[1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,2],c:[{n:[,,134],f:[]},{n:[,,,,,,,,,,,,,,,,,,,,,,,,,,,134],f:[]}]}],rowLen:7782,patternLen:32,endPattern:48,numChannels:16};
class FxSound{constructor(){this.loading={progress:0,total:song.numChannels};this.audio=document.createElement("audio")}init(){setTimeout(()=>{this.player=new SoundPlayer;this.player.init(song);const a=()=>{this.loading.progress=this.player.generate();if(this.loading.progress>=this.loading.total){const b=this.player.createWave();this.audio.src=URL.createObjectURL(new Blob([b],{type:"audio/wav"}))}else setTimeout(a,1)};a()},1)}start(){this.audio.play()}currentTime(){return this.audio.currentTime}}
class SoundPlayer{constructor(){var a,b,c,d,e,f=function(k){return Ms(6.283184*k)},g=[f,function(k){return.5>k%1?1:-1},function(k){return k%1*2-1},function(k){k=k%1*4;return 2>k?k-1:3-k}];this.init=function(k){a=k;b=k.endPattern;c=0;d=k.rowLen*k.patternLen*(b+1)*2;e=new Int32Array(d)};this.generate=function(){var k,h,n,l,m,p,q,y,v,u,x,w=new Int32Array(d),r=a.songData[c],C=a.rowLen,G=a.patternLen,M=0,H=0,S=!1,I=[];for(h=0;h<=b;++h){var D=0;for(l=r.p[h];D<G;++D){(n=l?r.c[l-1].f[D]:0)&&(r.i[n-1]=r.c[l-
1].f[D+G]||0,17>n&&(I=[]));var ca=g[r.i[16]],da=r.i[17]/512,ea=2**(r.i[18]-9)/C,fa=r.i[19],T=r.i[20],ha=135.82764118168*r.i[21]/44100,ia=1-r.i[22]/255,N=1E-5*r.i[23],ja=r.i[24]/32,ka=r.i[25]/512,la=6.283184*2**(r.i[26]-9)/C,U=r.i[27]/255,O=r.i[28]*C&-2;n=0;for(y=(h*G+D)*C;4>n;++n)if(k=l?r.c[l-1].n[D+n*G]:0){if(!I[k]){var z=I;var J=k,V=void 0,W=void 0,K,A,t=r,X=k,ma=g[t.i[0]],na=t.i[1],oa=t.i[3]/32,pa=g[t.i[4]],qa=t.i[5],ra=t.i[8]/32,Y=t.i[9],E=t.i[10]*t.i[10]*4,L=t.i[11]*t.i[11]*4,Q=t.i[12]*t.i[12]*
4,sa=1/Q,ta=-t.i[13]/16,F=t.i[14],ua=C*2**(2-t.i[15]),Z=new Int32Array(E+L+Q),aa=0,ba=0;for(K=A=0;A<E+L+Q;A++,K++){0<=K&&(F=F>>8|(255&F)<<4,K-=ua,W=.003959503758*2**((X+(15&F)+t.i[2]-128-128)/12),V=.003959503758*2**((X+(15&F)+t.i[6]-128-128)/12)*(1+8E-4*t.i[7]));var B=1;A<E?B=A/E:A>=E+L&&(B=(1-(B=(A-E-L)*sa))*3**(ta*B));aa+=W*B**oa;var R=ma(aa)*na;ba+=V*B**ra;R+=pa(ba)*qa;Y&&(R+=(2*Math.random()-1)*Y);Z[A]=80*R*B|0}z[J]=Z}J=I[k];z=0;for(k=2*y;z<J.length;z++,k+=2)w[k]+=J[z]}for(z=0;z<C;z++)(q=w[m=
2*(y+z)])||S?(v=ha,fa&&(v*=ca(ea*m)*da+.5),M+=(v=1.5*Ms(v))*H,u=ia*(q-H)-M,H+=v*u,q=3==T?H:1==T?u:M,N&&(q*=N,q=1>q?-1<q?f(.25*q):-1:1,q/=N),q*=ja,S=1E-5<q*q,x=q*(1-(p=Ms(la*m)*ka+.5)),q*=p):x=0,m>=O&&(x+=w[m-O+1]*U,q+=w[m-O]*U),w[m]=0|x,w[m+1]=0|q,e[m]+=0|x,e[m+1]+=0|q}}return++c};this.createAudioBuffer=function(k){k=k.createBuffer(2,d/2,44100);for(var h=0;2>h;h++)for(var n=k.getChannelData(h),l=h;l<d;l+=2)n[l>>1]=e[l]/65536;return k};this.createWave=function(){var k=44+2*d-8,h=k-36,n=new Uint8Array(44+
2*d);n.set([82,73,70,70,255&k,k>>8&255,k>>16&255,k>>24&255,87,65,86,69,102,109,116,32,16,0,0,0,1,0,2,0,68,172,0,0,16,177,2,0,4,0,16,0,100,97,116,97,255&h,h>>8&255,h>>16&255,h>>24&255]);k=0;for(h=44;k<d;++k){var l=e[k];l=-32767>l?-32767:32767<l?32767:l;n[h++]=255&l;n[h++]=l>>8&255}return n};this.getData=function(k,h){for(var n=2*Math.floor(44100*k),l=Array(h),m=0;m<2*h;m+=1){var p=n+m;l[m]=0<k&&p<e.length?e[p]/32768:0}return l}}}
class FxIntro{constructor(){this.loading={progress:0,total:1}}init(){setTimeout(()=>{this.loading.progress=1},1)}neon(a,b,c,d,e){a.lineWidth=b;a.shadowBlur=c;a.shadowColor="rgba(255, 0, 0, 1)";a.strokeStyle=`rgba(255, 0, 0, ${d})`;for(var f=2;f--;)e();a.lineWidth=b/3;a.shadowBlur=c/10;a.shadowColor="rgba(255, 170, 170, 1)";a.strokeStyle=`rgba(255, 170, 170, ${d})`;e()}intro_p1({ctx:a,time:b}){a.save();a.translate(960,600);const c=lerp(7,1.8,step(0,8,b));a.scale(c,c);this.neon(a,80,80,1-easein(step(7.5,
8,b)),()=>{a.beginPath();a.moveTo(-660,1320);a.lineTo(0,-720);a.lineTo(660,1320);a.stroke()});a.restore()}intro_p2({ctx:a,time:b}){a.save();a.translate(800,1200);const c=lerp(1.15,.82,step(0,3,b));a.scale(c,c);this.neon(a,80,80,step(0,.5,b)-easein(step(2.5,3,b)),()=>{a.beginPath();a.moveTo(-910,-1600);a.lineTo(330,-680);a.lineTo(330,-1600);a.moveTo(700,-1600);a.lineTo(700,22);a.moveTo(-1023,-775);a.lineTo(230,85);a.stroke()});a.restore()}intro_p3({ctx:a,time:b}){const c=step(0,4,b);b=step(0,.5,b)-
easein(step(3.5,4,b));a.save();a.translate(0,550);a.scale(lerp(1.5,.95,c),1);a.translate(-lerp(0,100,c),0);a.font="3000px serif";this.neon(a,70,80,b,()=>{a.strokeText("O",-1200,1086)});a.restore();this.neon(a,70,80,b,()=>{a.beginPath();a.moveTo(lerp(1820,1880,c),-10);a.lineTo(lerp(1820,1880,c),1300);a.stroke()})}intro_p4({ctx:a,time:b}){const c=step(0,4,b);b=step(0,.5,b)-easein(step(3.5,4,b));a.lineWidth=50;a.shadowBlur=80;a.shadowColor="#FF0000";a.strokeStyle="#FF0000";a.save();a.translate(960,600);
const d=lerp(1,.9,c);a.scale(d,d);this.neon(a,60,80,b,()=>{a.font="3000px serif";a.strokeText("S",lerp(-770,-140,c),-110);a.font="3000px serif";a.strokeText("G",lerp(-1280,-1730,c),2100)});a.restore()}intro_p5({ctx:a,time:b}){const c=step(0,4,b);b=step(0,.5,b)-easein(step(3.5,4,b));a.save();a.translate(960,600);this.neon(a,50,80,b,()=>{a.font="3000px serif";a.strokeText("H",lerp(-10,-200,c),lerp(1760,1360,c));a.font="2000px serif";a.strokeText("N",lerp(-1520,-1340,c),lerp(10,470,c))});a.restore()}intro_p6({ctx:a,
time:b}){a.save();a.translate(960,600);a.font="800px serif";const c=step(1,6,b);this.neon(a,30,80,easein(step(1,3,b))-step(5.5,6,b),()=>{a.strokeText("N",lerp(-850,-650,c),260);a.strokeText("G",lerp(390,120,c),260)});a.font="1500px serif";const d=step(0,5,b);this.neon(a,40,80,step(0,.5,b)-easein(step(3,5,b)),()=>{a.strokeText("C",lerp(-1210,-1410,d),lerp(-230,-60,d));a.strokeText("A",lerp(240,340,d),lerp(-210,-60,d));a.strokeText("S",lerp(-1470,-1170,d),lerp(1120,1350,d));a.strokeText("G",lerp(300,
0,d),lerp(1120,1350,d))});a.restore()}intro_p7({ctx:a,time:b}){var c=step(0,20,b);a.save();c=lerp(5.3,.9,easeoutsine(c));const d=step(0,.5,b)-easeinout(step(16.5,19,b));a.translate(960,640);a.scale(c,c);this.neon(a,8,20,d,()=>{a.font="260px serif";a.strokeText("C",-477-78*(1-easeout(step(9.2,14.8,b))),4);a.strokeText("S",284+70*(1-easeout(step(7.8,14,b))),4);a.font="210px serif";a.strokeText("A",-290-60*(1-step(1,4,b)),-31);a.strokeText("N",-132-30*(1-step(0,3,b)),-31);a.strokeText("V",22,-31);a.strokeText("A",
128+50*(1-step(0,8.5,b)),-31-100*(1-step(0,8.5,b)));a.font="160px serif";a.strokeText("T",-308-90*(1-step(3,7,b)),113);a.strokeText("H",-210,113+150*(1-step(3.1,7,b)));a.strokeText("I",-94-100*(1-step(0,3.8,b)),113);a.strokeText("N",-41,113+120*(1-step(0,6,b)));a.strokeText("GS",74+100*(1-step(0,4.6,b)),113);if(12<=b){const e=lerp(0,935,step(12,13.5,b));a.strokeRect(-12.5-e/2,-213,e-30,18)}13.5<=b&&(a.strokeRect(-333,39,-lerp(0,147,step(13.5,15,b)),18),a.strokeRect(300,39,lerp(0,127,step(13.5,15,
b)),18))});a.restore()}render({ctx:a,time:b}){a.save();a.scale(a.W/1920,a.H/1200);a.shadowBlur=0;a.fillStyle="#000";a.fillRect(0,0,1920,1200);a.lineJoin="round";const c=[[8,e=>this.intro_p1(e)],[3,e=>this.intro_p2(e)],[4,e=>this.intro_p3(e)],[4,e=>this.intro_p4(e)],[4,e=>this.intro_p5(e)],[6,e=>this.intro_p6(e)],[20,e=>this.intro_p7(e)]];var d=0;for(const e of c){if(b<=d+e[0]){e[1]({ctx:a,time:b-d});break}d+=e[0]}a.restore()}}
class FxCRT{constructor(){this.loading={progress:0,total:4}}init({width:a,height:b}){setTimeout(()=>{this.turnOnCanvasCtx=Co(this.turnOnCanvas=Ca(a,b));this.loading.progress++;const c=Co(this.crtOverlay=Ca(a,b));this.drawLines(c);this.drawFrame(c);this.loading.progress++;this.tearingCtx=Co(this.tearingCanvas=Ca(a,b));this.loading.progress++;this.generateNoise(a,b);this.loading.progress++},1)}drawLines(a){a.lineWidth=1;a.strokeStyle="rgba(210, 210, 210, 0.15)";for(var b=0;b<a.H/2;b++)a.beginPath(),
a.moveTo(0,5*b),a.lineTo(a.W,5*b),a.stroke()}drawFrame(a){a.save();a.scale(a.W/1920,a.H/1200);a.lineWidth=5;a.fillStyle="#000";a.shadowColor="#000";for(var b=0;10>b;b++)a.shadowBlur=30-2*b,a.beginPath(),a.moveTo(710,10),a.lineTo(1210,10),a.bezierCurveTo(1930,10,1910,-10,1910,710),a.lineTo(1910,490),a.bezierCurveTo(1910,1210,1930,1190,1210,1190),a.lineTo(710,1190),a.bezierCurveTo(-10,1190,10,1200,10,490),a.lineTo(10,710),a.bezierCurveTo(10,-10,-10,10,710,10),a.rect(1920,0,-1920,1200),a.fill();a.restore()}generateNoise(a,
b){a=Co(this.noiseCanvas=Ca(2*a,2*b));b=a.createImageData(a.W,a.H);const c=b.data;for(var d=0,e=c.length;d<e;d+=4)c[d]=c[d+1]=c[d+2]=255*Math.random(),c[d+3]=255;a.putImageData(b,0,0)}renderTurnOn({ctx:a,time:b}){this.turnOnCanvasCtx.save();this.turnOnCanvasCtx.clearRect(0,0,a.W,a.H);this.turnOnCanvasCtx.fillStyle="#fff";var c=step(0,.4,b);c=easein(c)*a.W;var d=step(.4,1,b);d=easeout(d)*a.H;this.turnOnCanvasCtx.shadowColor="#fff";this.turnOnCanvasCtx.shadowBlur=80;this.turnOnCanvasCtx.fillRect(a.W/
2-c/2,a.H/2-d/2,c,d+2);this.turnOnCanvasCtx.globalCompositeOperation="source-atop";this.turnOnCanvasCtx.drawImage(this.noiseCanvas,a.W*-Math.random()|0,a.H*-Math.random()|0);this.render({ctx:this.turnOnCanvasCtx,time:b});this.turnOnCanvasCtx.restore();a.fillStyle="#000";a.fillRect(0,0,a.W,a.H);a.drawImage(this.turnOnCanvas,0,0)}render({ctx:a,time:b}){if(6<b&&.2>b%10){this.tearingCtx.fillStyle="#000";this.tearingCtx.fillRect(0,0,a.W,a.H);var c=Math.random()*a.H;this.tearingCtx.drawImage(a.canvas,0,
0,a.W,c,0,0,a.W,c);this.tearingCtx.drawImage(a.canvas,0,c,a.W-20,a.H-c,20,c,a.W-20,a.H-c);this.tearingCtx.drawImage(a.canvas,a.W-20,c,20,a.H-c,0,c,20,a.H-c);a.drawImage(this.tearingCanvas,0,0)}b=120*b%(a.H+80)-80;c=a.createLinearGradient(0,b-40,0,b+40);c.addColorStop(0,"rgba(0, 0, 0, 0)");c.addColorStop(.4,"rgba(0, 0, 0, 0.3)");c.addColorStop(.6,"rgba(0, 0, 0, 0.3)");c.addColorStop(1,"rgba(0, 0, 0, 0)");a.fillStyle=c;a.fillRect(0,b-40,a.W,80);a.drawImage(this.crtOverlay,0,0)}}
class FxSopalin{constructor(){this.loading={progress:0,total:2}}init(){setTimeout(()=>{this.initDottedFlower();this.loading.progress++;this.ocanvas=document.createElement("canvas");this.ocanvas.width=960;this.ocanvas.height=600;this.octx=Co(this.ocanvas);this.ocanvas2=document.createElement("canvas");this.ocanvas2.width=960;this.ocanvas2.height=600;this.octx2=Co(this.ocanvas2);this.loading.progress++},1)}initDottedFlower(){this.dottedFlowerDots=[];var a=this.dottedPetalShape();const b=(d,e)=>{const f=
new Path2D;for(var g=0;3>g;g++)for(const k of d){const h=V2.rotated(e(k),2/3*Math.PI*g);this.dottedFlowerDots.push(h);f.moveTo(h.x,h.y);f.arc(h.x,h.y,8,0,2*Math.PI)}return f};var c=this.dividePath(a,40);c.splice(0,6);c.splice(-7,7);this.LPath=b(c,({x:d,y:e})=>P(1.3*d,1.1*e-88));c=this.dividePath(a,28);c.splice(0,2);c.splice(-2,2);this.MPath=b(c,({x:d,y:e})=>P(.9*d,.75*e));a=this.dividePath(a,14);a.splice(0,1);this.SPath=b(a,({x:d,y:e})=>P(.5*d,.45*e+74.4));this.InnerDots=b([P(0,183)],d=>d);this.dottedFlowerDots.push(P(0,
0));this.InnerDots.moveTo(0,0);this.InnerDots.arc(0,0,8,0,2*Math.PI)}renderDotterflower({ctx:a,time:b,pos:c}){a.save();a.translate(c.x,c.y);a.rotate(b);b=b/2*300+300;a.fillStyle=`hsl(${b%360},100%,50%)`;a.shadowColor=a.fillStyle;a.fill(this.InnerDots);a.fillStyle=`hsla(${1.2*b%360},100%,50%, 1)`;a.shadowColor=a.fillStyle;a.fill(this.SPath);a.fillStyle=`hsla(${1.4*b%360},100%,50%, 1)`;a.shadowColor=a.fillStyle;a.fill(this.MPath);a.fillStyle=`hsla(${1.6*b%360},100%,50%, 1)`;a.shadowColor=a.fillStyle;
a.fill(this.LPath);a.restore()}renderStars({ctx:a,time:b}){const c=this.dottedFlowerDots;a.save();a.scale(a.W/1920,a.H/1200);a.clearRect(0,0,1920,1200);a.translate(960,600);a.scale(1.2,1.2);for(var d=0;d<c.length;++d){const e=c[d],f=cellnoise(e.x*e.y)<tlerp(0,15,1,0,b)?0:1,g=.5*Mc(d+4*b)+.5+tlerp(13,15,0,.5,b);a.fillStyle=rgba(1,1,1,f*g);a.beginPath();a.moveTo(e.x,e.y);a.arc(e.x,e.y,8,0,2*Math.PI);a.fill()}a.restore()}renderShady({ctx:a,time:b}){const c=this.dottedFlowerDots;a.save();a.scale(a.W/
1920,a.H/1200);a.clearRect(0,0,1920,1200);a.translate(960,600);a.scale(1.2,1.2);for(var d=0;d<c.length;++d){const e=c[d];a.fillStyle=rgba(1,1,1,.5*noise1D(e.x*e.y/50+b)+.5);a.beginPath();a.moveTo(e.x,e.y);a.arc(e.x,e.y,8,0,2*Math.PI);a.fill()}a.restore()}renderColored({ctx:a,time:b}){const c=this.dottedFlowerDots;a.save();a.scale(a.W/1920,a.H/1200);a.clearRect(0,0,1920,1200);a.translate(960,600);a.scale(1.2,1.2);for(var d=0;d<c.length;++d){const e=c[d];a.fillStyle=`hsl(${10*(d+10*b)%360},100%,60%)`;
a.beginPath();a.moveTo(e.x,e.y);a.arc(e.x,e.y,8,0,2*Math.PI);a.fill()}a.restore()}renderTest({ctx:a}){a.save();a.scale(a.W/1920,a.H/1200);a.fillStyle="#000";a.fillRect(0,0,1920,1200);for(var b=0;1920>b;b+=13){const c=.5*noise1D(b/50)+.5;a.fillStyle=rgba(1,1,1,c);a.fillRect(b,0,10,1200)}a.restore()}render({ctx:a,time:b}){this.renderStars({ctx:this.octx,time:b});this.renderColored({ctx:this.octx2,time:b});a.save();a.scale(a.W/1920,a.H/1200);a.fillStyle="#000";a.fillRect(0,0,1920,1200);a.globalAlpha=
28>b?1-.8*step(20,23,b):1;for(var c=-1;4>c;++c)for(var d=318*c+200,e=0;8>e;++e){var f=278*e,g=d+(0<e%2?159:0),k=tlerp(17,18,-600,2520,b),h=1-easeout(saturate(Math.abs(f-k)/500));g-=80*h;a.save();a.translate(f,g);a.scale(1-h,1);a.rotate(2*Math.PI/3*(e+c));28<b&&(g=noise2D(f,d),a.scale(Ms(g*b),Mc(g*b)),a.translate(400*Ms(g*b),400*Mc(g*b)),a.rotate(Ms(g*b)));f>k?a.drawImage(this.ocanvas,0,0,this.ocanvas.width,this.ocanvas.height,-this.ocanvas.width/2,-this.ocanvas.height/2,this.ocanvas.width,this.ocanvas.height):
a.drawImage(this.ocanvas2,0,0,this.ocanvas2.width,this.ocanvas2.height,-this.ocanvas2.width/2,-this.ocanvas2.height/2,this.ocanvas2.width,this.ocanvas2.height);a.restore()}a.restore()}dividePath(a,b){var c=0;const d=[];for(var e=1;e<a.length;e++){var f=Math.hypot(a[e].x-a[e-1].x,a[e].y-a[e-1].y);d.push(f);c+=f}c/=b;e=[a[0]];f=0;for(var g=a[0],k=a[1],h=d[0],n=c,l=0;e.length<=b;){for(;1E-7<n-h;)n-=h,f++,g=a[f],k=a[f+1],h=d[f],l=0;var m=(l+n)/d[f];const p=lerp(g.x,k.x,m);m=lerp(g.y,k.y,m);e.push(P(p,
m));l+=n;h-=n;n=c}return e}dottedPetalShape(){const a=[],b=[],c=Math.sqrt(14)/50;for(var d=0;50>=d;d++){const f=c*d;var e=1-(f**2/7-1)**2;e=0>e?0:Math.sqrt(e);a.push(P(100*e,100*f));b.unshift(P(100*-e,100*f))}return[...a,...b]}}
class FxFlowers{constructor(){this.loading={progress:0,total:1}}init(){setTimeout(()=>{this.flowers=[];this.ocanvas=Ca(1920,1200);this.octx=Co(this.ocanvas);this.ocanvas2=Ca(1920,1200);this.octx2=Co(this.ocanvas2);this.loading.progress++},1)}__buildFlower({l:a,cs:b,tw:c,cy:d,np:e,cp1:f,cp2:g}){const k=[{x:-c,y:d},{x:0,y:a},{x:c,y:d}];c=[{x:-c,y:d-f},{x:c,y:d-f},{x:-c,y:d+f},{x:-g,y:a},{x:c,y:d+f},{x:g,y:a}];d=randColor();f=randColor();return{length:a,points:k,control_points:c,nb_petal:e,color_center:d,
color_petal:f,center_size:b,life:0}}randomFlower(){const a=randIntBetween(10,25),b=a+randBetween(20,90),c=randBetween(.4,.9)*b,d=randBetween(.2,.7)*b/2,e=randBetween(.4,.9)*c,f=randBetween(.2,.9)*d,g=Math.round(randBetween(4,10));return this.__buildFlower({l:b,cs:a,tw:d,cy:c,np:g,cp1:e,cp2:f})}drawFlower({ctx:a,time:b,flower:c}){a.globalAlpha=.88;a.shadowBlur=5;a.shadowOffsetX=2;a.shadowOffsetY=2;a.shadowColor="#333";const d=saturate(c.life/1.5),e=easeout(saturate(c.life/1.5));a.fillStyle=c.color_petal;
const f=2*Math.PI/c.nb_petal;a.save();a.rotate(b/2);for(b=0;b<c.nb_petal;b++)a.rotate(f),a.beginPath(),a.moveTo(0,0),a.quadraticCurveTo(c.control_points[0].x*d,c.control_points[0].y,c.points[0].x*d,c.points[0].y*d),a.bezierCurveTo(c.control_points[2].x*d,c.control_points[2].y*d,c.control_points[3].x*d,c.control_points[3].y*d,c.points[1].x*d,c.points[1].y*d),a.bezierCurveTo(c.control_points[5].x*d,c.control_points[5].y*d,c.control_points[4].x*d,c.control_points[4].y*d,c.points[2].x*d,c.points[2].y*
d),a.quadraticCurveTo(c.control_points[1].x*d,c.control_points[1].y*d,0,0),a.fill();a.restore();a.fillStyle=c.color_center;a.beginPath();a.arc(0,0,c.center_size*e,0,2*Math.PI);a.fill()}render({ctx:a,time:b}){this.lastTime||(this.lastTime=b);const c=b-this.lastTime;this.lastTime=b;0>c&&(this.octx2.clearRect(0,0,1920,1200),this.flowers=[]);this.nextSpawn-=c;if(!this.nextSpawn||0>=this.nextSpawn)this.flowers.push({shape:this.randomFlower(),pos:P(1920*Math.random(),1200*Math.random())}),this.nextSpawn=
.04;this.octx2.clearRect(0,0,this.octx2.W,this.octx2.H);for(var d=0;d<this.flowers.length;++d){const e=this.flowers[d];this.octx2.save();this.octx2.translate(e.pos.x,e.pos.y);this.drawFlower({ctx:this.octx2,time:b,flower:e.shape});this.octx2.restore();1.5<=e.shape.life+c&&(this.flowers.splice(d--,1),this.octx.save(),this.octx.translate(e.pos.x,e.pos.y),this.drawFlower({ctx:this.octx,time:b,flower:e.shape}),this.octx.restore());e.shape.life+=c}a.save();a.scale(a.W/1920,a.H/1200);a.fillStyle="#000";
a.fillRect(0,0,1920,1200);a.drawImage(this.ocanvas,0,0);a.drawImage(this.ocanvas2,0,0);a.restore()}}
class FxWords{constructor(){this.loading={progress:0,total:2}}init(){setTimeout(()=>{this.noise1D=[];for(var a=0;2048>a;a++)this.noise1D.push(Math.random());this.ocanvas=Ca(1920,1200);this.octx=Co(this.ocanvas);this.loading.progress++;this.words=[this.scanWord("randomize.",30),this.scanWord("Flowers ?",18)];this.octx.clearRect(0,0,this.octx.W,this.octx.H);this.loading.progress++},1)}scanWord(a,b){const c=[];var d=P(1920,1200),e=P(0,0);this.octx.save();this.octx.fillStyle="#000";this.octx.fillRect(0,
0,1920,1200);this.octx.fillStyle="#fff";this.octx.font=""+b+"px cursive";this.octx.fillText(a,20,300);this.octx.restore();a=this.octx.getImageData(0,0,this.octx.W,this.octx.H);b=a.data;for(var f=0;f<this.octx.W*this.octx.H;f++)if(125<b[4*f]){const h=P(f%a.width,Math.round(f/a.width));c.push(h);h.x<d.x&&(d.x=h.x);h.y<d.y&&(d.y=h.y);h.x>e.x&&(e.x=h.x);h.y>e.y&&(e.y=h.y)}a=e.x-d.x;e=e.y-d.y;const g=d.x+a/2,k=d.y+e/2;return{width:a,height:e,pixels:c.map(h=>P(h.x-g,h.y-k))}}renderChaos({ctx:a,time:b}){b%=
12;a.save();a.scale(a.W/1920,a.H/1200);a.translate(960,600);var c=0;a.shadowBlur=tlerp(8,9,0,6,b);const d=this.words[0];for(var e of d.pixels){void 0===e.e&&(e.e=P(2*Math.random()-1,2*Math.random()-1));const g=360*(c/d.pixels.length+b);var f=step(0,2,b);const k=step(9,11,b),h=step(8,9,b)-step(9,9.1,b),n=1-step(10,11,b),l=e.x*f+300*e.e.x*k+3*(2*Math.random()-1)*h;f=e.y*f+300*e.e.y*k+3*(2*Math.random()-1)*h;a.fillStyle=4<b?`hsla(${g%360}, 100%, 50%, ${n})`:rgba(1,1,1,1);a.shadowColor=a.fillStyle;a.fillRect(11*
l-4,11*f-4,9,9);++c}a.restore()}spawnFlowerParticle({x:a,y:b},c){this.particles.push({l:c,ang:randBetween(-5,5)*Math.PI/180*0,spd:(c?3:1)*randBetween(10,13),duration:c?10:randBetween(1,3),lifetime:0,dir:V2.normalized(P(randBetween(-1,1),randBetween(-1,1))),pos:{x:a,y:b},orig:{x:a,y:b},color:{r:Math.round(255*Math.random()),g:Math.round(255*Math.random()),b:Math.round(255*Math.random())}})}renderFlower({ctx:a,time:b}){b*=4;var c=b-(this.lastTime||b);0>c&&(this.octx.clearRect(0,0,this.octx.W,this.octx.H),
this.particles=[]);this.lastTime=b;if(!this.particles||0==this.particles.length){this.particles=[];for(var d of this.words[1].pixels){for(var e=20*d.x,f=20*d.y,g=0;9>g;++g)this.spawnFlowerParticle({x:e+g%3*5,y:f+5*(g/3|0)},!1);this.spawnFlowerParticle({x:e,y:f},!0)}this.particles.sort(()=>Math.random()-.5)}this.octx.save();this.octx.scale(this.octx.W/1920,this.octx.H/1200);this.octx.translate(960,600);this.octx.shadowBlur=3;this.octx.shadowOffsetX=this.octx.shadowOffsetY=2;this.octx.shadowColor="#0005";
d=c;c=.05;for(e=0;e<=d;){for(g=0;g<Mm(250,this.particles.length);++g){f=this.particles[g];f.lifetime+=c;if(f.lifetime>=f.duration){this.particles.splice(g--,1);this.spawnFlowerParticle(f.orig,f.l);continue}var k=f.spd;f.ang+=(f.l?randBetween(-20,20):randBetween(-45,45))*Math.PI/180*c;var h=Ms(f.ang),n=Mc(f.ang);const l=f.dir.x*h+f.dir.y*n;f.dir.x=f.dir.x*n-f.dir.y*h;f.dir.y=l;h=f.pos.x+f.dir.x*k*c;k=f.pos.y+f.dir.y*k*c;n=f.l?.4:bounce(f.lifetime/f.duration);this.octx.fillStyle=`rgba(${f.color.r},${f.color.g},${f.color.b},${n})`;
this.octx.beginPath();this.octx.arc(h,k,1.5*n,0,2*Math.PI);this.octx.fill();f.pos.x=h;f.pos.y=k}e+=c}this.octx.restore();a.save();a.scale(a.W/1920,a.H/1200);a.globalAlpha=tlerp(15,18,1,0,b/4);a.drawImage(this.ocanvas,0,-50);a.restore()}render({ctx:a}){a.save();a.fillStyle="#000";a.fillRect(0,0,a.W,a.H);a.restore()}}
class FxTunnel{constructor(){this.loading={progress:0,total:1}}init(){setTimeout(()=>{this.ocanvas=Ca(1920,1200);this.octx=Co(this.ocanvas);this.loading.progress++},1)}timeFn(a){var b=a-2*step(0,2,a);return b-=2*easeout(step(2,8,a))}_render({ctx:a,time:b}){var c=tlerp(0,2,0,27,b)+tlerp(30,35,0,50,b)-tlerp(40,43,0,21,b),d=tlerp(2,8,1,.4,b)+tlerp(11,13,0,.6,b)-lerp(0,1,step(35,60,b));this.tt=this.timeFn(b)*tlerp(45,55,7,11,b);a.fillStyle="rgba(0,0,0,"+d+")";a.fillRect(0,0,a.W,a.H);a.save();a.translate(a.W/
2,a.H/2);for(d=1;d<c;d++){const p=(this.tt|0)+d,q=this.tt%1,y=(a.W+800)/(2*(d-q)),v=p/20|0;if(!(379<=p+d)){var e=tlerp(130,160,.128,.183,p)-tlerp(217,225,0,.004,p),f=tlerp(130,160,48,24,p)+tlerp(217,225,0,10,p),g=tlerp(50,80,0,.1,p)-tlerp(220,240,0,.1,p)+tlerp(310,340,0,.1,p)-tlerp(370,379,0,.1,p),k=tlerp(50,80,300,170,p)-tlerp(130,160,0,170,p)+tlerp(180,200,0,170,p),h=tlerp(50,80,.1,30,p),n=tlerp(130,160,0,1,p),l={h:120<p?80*v%360:198,s:tlerp(90,100,0,1-(d-q)/c,p),v:step(0,2,b)},m=lerp(.5*d,.5*(d-
1),q);a.globalAlpha=2>=d?g*m:g;a.fillStyle=hsv2hsl(l);a.beginPath();for(g=0;g<f+1;g++){l=Math.PI+(g-f/2)*e;m=lerp(1.9,40,easein(n));m=[1.1,Mm(1/Math.abs(Mc(l+p/3)),1/Math.abs(Ms(l+p/3))),Mm(1/Math.abs(Mc(l)),1/Math.abs(Ms(l))),Math.abs(Ms(l/(Math.max(29,200-30*p)/100)))/4+.7,Math.abs(Ms(l/.5+p))/m+1.1*(1-1/m*.86)][120>p?4:v%5];l=P(Ms(l)*m*y,Mc(l)*m*y);m=(d-q)/c;l.x+=Ms(p/h)*k*m;l.y+=Mc(p/h)*k*m;if(18>=d&&g%2){a.save();m=1-(d-1-q)/30;const u=12*easein(m);a.globalAlpha=m*[1,.5*Ms(7*b+p+g)+.5][95>p?
0:121>p?1:v%2];a.fillRect(l.x-u/2,l.y-u/2,u,u);a.restore()}0==g?a.moveTo(l.x,l.y):a.lineTo(l.x,l.y)}a.fill();a.clip()}}a.restore()}render({ctx:a,time:b}){this._render({ctx:this.octx,time:b});a.save();a.scale(a.W/1920,a.H/1200);a.drawImage(this.ocanvas,0,0);a.restore()}}
const squareShape=a=>P(a.x,a.y,a.z),sphereShape=a=>{const b=V3.normalized(P(a.x,a.y,0)),c=2.8*Math.sqrt(1-((a.z+2.6)/5.4*2-1)**2);return P(b.x*c,b.y*c,a.z)},coneShape=a=>{const b=V3.normalized(P(a.x,a.y,0)),c=14*(1-Math.abs(2*((a.z+2.6)/5.4-.5)))*.2;return P(b.x*c,b.y*c,a.z)},cylinderShape=a=>{const b=V3.normalized(P(a.x,a.y,0));return P(2*b.x,2*b.y,a.z)},flowerShape=a=>{const b=V3.normalized(P(a.x,a.y,0)),c=Mc(2*Math.atan2(b.x,b.y));return P(b.x*c+1.8*b.x,b.y*c+1.8*b.y,a.z)},flowerShape2=a=>{const b=
V3.normalized(P(a.x,a.y,0)),c=Mc(4*Math.atan2(b.x,b.y));return P(b.x*c+1.8*b.x,b.y*c+1.8*b.y,a.z)},flowerShape3=a=>{const b=V3.normalized(P(a.x,a.y,0)),c=Mc(6*Math.atan2(b.x,b.y));return P(b.x*c+1.8*b.x,b.y*c+1.8*b.y,a.z)},triangleShape=a=>{const b=V3.normalized(P(a.x,a.y,0)),c=V3.dot(P(a.x,a.y,0),P(0,1,0));return P((c+2)/4*b.x*2,c,a.z)};
class FxCage3D{constructor(){this.loading={progress:0,total:1}}init(){setTimeout(()=>{this.ocanvas=Ca(1920,1200);this.octx=Co(this.ocanvas);this.genFrames();this.loading.progress++},1)}genFrameSegments(a){a=[P(-2,2,a),P(2,2,a),P(2,-2,a),P(-2,-2,a),P(-2,2,a)];const b=2/30*2,c=[];for(var d=1;d<a.length;d++){const f=a[d-1],g=V3.normalized(V3.minus(a[d],f));for(var e=0;30>e;e++){const k=P(f.x+g.x*b*(e-.02),f.y+g.y*b*(e-.02),f.z+g.z*b*(e-.02)),h=P(f.x+g.x*b*(e+.5),f.y+g.y*b*(e+.5),f.z+g.z*b*(e+.5)),n=
P(f.x+g.x*b*(e+1.02),f.y+g.y*b*(e+1.02),f.z+g.z*b*(e+1.02));c.push({start:k,end:n,center:h})}}return c}genFrames(){this.frames=[];for(var a=0;27>a;a++){const b=this.genFrameSegments(.02*(a-13));this.frames.push(b)}}compareSegments(a,b){return(b[0].z+b[1].z)/2-(a[0].z+a[1].z)/2}drawMorphings({ctx:a,time:b}){var c=0,d=60/85;if(44.1<=b){var e=b-44.1;c=bounce(step(0,d/4,e%(2*d)))/4;d=bounce(step(d/4,3*d/4,e%(2*d)))/4;c+=d}a.fillStyle="#000";a.fillRect(0,0,a.W,a.H);if(!(1.97>b)){b-=2.45;d=M4.frustum(90,
a.W/a.H,1,20);e=M4.lookAt(P(0,0,7),P(0,0,0),P(0,1,0));var f=w=>P(a.W*(w.x/w.w*.5+.5),a.H*(1-(w.y/w.w*.5+.5)),w.z/w.w,w.w),g=[],k=[sphereShape,squareShape,flowerShape,cylinderShape,coneShape,flowerShape2,triangleShape,flowerShape3],h=[15,24,23,29,9,25,29,24],n=[8,9,9,9,6,8,9,8],l=60/85/4*8,m=b/l|0,p=(b+.8)/l|0;l=easeinout(step(0,.8,(b-l+.8)%l));var q=k[m%k.length],y=k[p%k.length];h=lerp(h[m%k.length]/5,h[p%k.length]/5,l);k=lerp(n[m%k.length]/5,n[p%k.length]/5,l);k=(14<b?tlerp(18,18.5,h,k,b):tlerp(9,
14,0,h,b))+tlerp(32,33,0,8,b);for(n=1;n<(9>b?2:this.frames.length);n++){m=M4.identity();m=M4.multiply(m,M4.rotationX((b-18)*tlerp(18,19,0,.6,b)));p=Ms(b)*n/10;h=(b-9)*tlerp(9,14,0,.7,b);m=M4.multiply(m,M4.rotationZ(lerp(h,p,step(38.9,60,b))));m=M4.multiply(m,e);m=M4.multiply(m,d);for(var v of this.frames[n]){p={...v.start};p.z*=k;h={...v.end};h.z*=k;h=[q(p),q(h),y(p),y(h)];for(var u of h)u.x*=1+.4*Math.random()*c,u.y*=1+.4*Math.random()*c,u.z*=1+.4*Math.random()*c;p=V3.lerp(h[0],h[2],l);h=V3.lerp(h[1],
h[3],l);p=f(V3.mat_mult(p,m));h=f(V3.mat_mult(h,m));0>p.z||1<p.z||0>h.z||1<h.z||g.push([p,h])}}g.sort(this.compareSegments);for(var x of g)v=tlerp(8,10,.5,step(.575,.869,(x[0].z+x[1].z)/2),b),u=(50*b|0)%360,d=lerp(1,.1,v)*lerp(1,.6*Math.random()+.4,c),a.strokeStyle=`hsl(${u|0}, 90%, ${100*d|0}%)`,a.lineWidth=lerp(7,3,v),a.beginPath(),a.moveTo(x[0].x,x[0].y),a.lineTo(x[1].x,x[1].y),a.stroke()}}render({ctx:a,time:b}){this.drawMorphings({ctx:this.octx,time:b});a.save();a.scale(a.W/1920,a.H/1200);a.drawImage(this.ocanvas,
0,0);a.restore()}}
class FxCredits{constructor(){this.loading={progress:0,total:1}}init(){setTimeout(()=>{this.ocanvas2=Ca(300,300);this.octx2=Co(this.ocanvas2);this.ballImg=this.octx2.createImageData(300,300);this.loading.progress++},1)}ball({ctx:a,time:b}){const c=k=>{const h=P(0,0,20);var n=P(Ms(k.x+b),Mc(k.y+2*b),Ms(k.z-3*b));n=n.x*n.y*n.z*.5+.5;return V3.length(V3.minus(k,h))-(7*(step(16,19,b)-step(24,26,b))-2*n)},d=k=>{for(var h=0,n=0;100>n;n++){const m=V3.mult(k,h);var l=c(m);if(.01>l)return m;h+=l;if(30<=h)break}return null};
for(var e=0;300>e;e+=2){const k=e/300-.5;for(var f=0;300>f;++f){var g=d(V3.normalized(P(f/300-.5,k,1.25)));const h=1200*e+4*f;null!==g?(g=V3.normalized(P(c(P(g.x+.001,g.y,g.z))-c(P(g.x-.001,g.y,g.z)),c(P(g.x,g.y+.001,g.z))-c(P(g.x,g.y-.001,g.z)),c(P(g.x,g.y,g.z+.001))-c(P(g.x,g.y,g.z-.001)))),g=saturate(V3.dot(g,V3.normalized(P(Mc(3*b),Ms(3*b),-1)))),g=P(lerp(.6,0,g),lerp(.8,0,g),lerp(.8,1,g)),this.ballImg.data[h]=255*g.x,this.ballImg.data[h+1]=255*g.y,this.ballImg.data[h+2]=255*g.z,this.ballImg.data[h+
3]=255):this.ballImg.data[h+3]=0}}a.putImageData(this.ballImg,0,0)}neon(a,b,c,d){a.lineWidth=b;a.shadowBlur=c;a.shadowColor=a.strokeStyle="#0059ff";for(var e=2;e--;)d();a.lineWidth=b/3;a.shadowBlur=c/10;a.shadowColor=a.strokeStyle="#fff";d()}render({ctx:a,time:b}){this.ball({ctx:this.octx2,time:b});a.save();a.scale(a.W/1920,a.H/1200);a.lineJoin="round";a.fillStyle="#000";a.fillRect(0,0,1920,1200);a.drawImage(this.ocanvas2,840,420);const c=P(960,600);var d=0;if(3<b&&21>b){b-=3;const e=k=>0<k?10*Ms(k)+
e(k-1):0,f=["BeTomorrow","Canvas Things 2022","By David Sarrio"][b/6|0].substring(0,e(b)|0);a.font="bold italic 90px consolas";const g=a.measureText(f);d=g.width/2;this.neon(a,6.8,17.4,()=>{a.strokeText(f,c.x-g.width/2,c.y)})}0<(2*b|0)%2&&21>b&&(a.fillStyle="#fff",a.fillRect(c.x+d+10,c.y-70,3,90));a.restore()}}
class Demo{constructor(){this.FX={CRT:new FxCRT,Sound:new FxSound,Intro:new FxIntro,Sopalin:new FxSopalin,Flowers:new FxFlowers,Words:new FxWords,Tunnel:new FxTunnel,Cage3D:new FxCage3D,Credits:new FxCredits};this.debug=!1;this.ctx=void 0}runFullscreen(){document.documentElement.requestFullscreen({navigationUI:"hide"}).then(()=>{document.addEventListener("fullscreenchange",()=>{document.fullscreenElement||window.location.reload()});setTimeout(()=>{this.run({width:window.screen.width,height:window.screen.height})},
1E3)}).catch(a=>{alert(`fullscreen rejected (${a.message}, ${a.name})`)})}run({width:a,height:b}){var c=b,d=1.6*c|0;d>a&&(c=a/1.6|0);this.canvas=Ca(d,c);this.ctx=Co(this.canvas);document.body.innerHTML="";document.body.append(this.canvas);Object.values(this.FX).forEach(e=>e.init({width:d,height:c}));requestAnimationFrame(()=>this.renderLoading())}renderLoading(){const a=this.ctx;a.fillStyle="#000";a.fillRect(0,0,this.ctx.W,this.ctx.H);var b=0,c=0;Object.values(this.FX).forEach(f=>{b+=f.loading.total});
Object.values(this.FX).forEach(f=>{c+=f.loading.progress});const d=.7*a.W,e=.05*a.H;a.save();a.lineWidth=8;a.strokeStyle="#fff";a.fillStyle="#fff";a.translate(a.W/2,a.H/2);a.fillRect(-d/2,-e/2,d*c/b,e);a.strokeRect(-d/2,-e/2,d,e);a.restore();c>=b?(a.fillStyle="#000",a.fillRect(0,0,a.W,a.H),setTimeout(()=>{this.FX.Sound.start();this.initDebug();requestAnimationFrame(()=>this.renderDemo())},2E3)):requestAnimationFrame(()=>this.renderLoading())}renderDemo(){var a=this.FX.Sound.currentTime();const b=
this.ctx;b.fillStyle="#000";b.fillRect(0,0,b.W,b.H);var c=[[4.5,f=>{this.FX.CRT.renderTurnOn({ctx:b,time:f})}],[2,f=>{this.FX.CRT.render({ctx:b,time:f})}],[50,f=>{this.FX.Intro.render({ctx:b,time:f});this.FX.CRT.render({ctx:b,time:f})}],[40,f=>{(25>f||30<f)&&this.FX.Sopalin.render({ctx:b,time:f});21<f&&32>f&&this.FX.Words.renderChaos({ctx:b,time:f-21});b.fillStyle=rgba(0,0,0,step(39,40,f));b.fillRect(0,0,b.W,b.H);this.FX.CRT.render({ctx:b,time:f})}],[30,f=>{17<f&&this.FX.Flowers.render({ctx:b,time:f-
14});2<f&&20>f&&this.FX.Words.renderFlower({ctx:b,time:f-2});b.fillStyle=rgba(0,0,0,step(29,30,f));b.fillRect(0,0,b.W,b.H);this.FX.CRT.render({ctx:b,time:f})}],[60,f=>{this.FX.Cage3D.render({ctx:b,time:f});b.fillStyle=rgba(0,0,0,step(58.5,59,f));b.fillRect(0,0,b.W,b.H);this.FX.CRT.render({ctx:b,time:f})}],[51,f=>{this.FX.Tunnel.render({ctx:b,time:f});b.fillStyle=rgba(0,0,0,step(60.5,61,f));b.fillRect(0,0,b.W,b.H);this.FX.CRT.render({ctx:b,time:f})}],[27,f=>{this.FX.Credits.render({ctx:b,time:f});
this.FX.CRT.render({ctx:b,time:f})}],[4.5,f=>{this.FX.CRT.renderTurnOn({ctx:b,time:4.5-f})}],[3,()=>{}],[2,()=>{window.location.reload()}]],d=0;for(e of c){if(a<d+e[0]){c=a-d;e[1](c);if(this.debug){var e=Math.trunc(1E5*a)/1E5;d=Math.round(a/(60/85/4));a=d/32;d%=32;c=Math.trunc(1E5*c)/1E5;b.fillStyle="#fff";b.font="20px monospace";b.fillText(`      beat: ${a|0}:${d}`,0,50);b.fillText(`sound time: ${e}`,0,70);b.fillText(`scene time: ${c}`,0,90)}break}d+=e[0]}requestAnimationFrame(()=>this.renderDemo())}initDebug(){if(!(0>
window.location.href.indexOf("debug"))){this.debug=!0;var a=document.createElement("div");a.style.textAlign="center";a.style.position="absolute";a.style.bottom="20px";a.style.left="0";a.style.right="0";document.body.append(a);var b=document.createElement("input");b.type="range";b.min=0;b.value=0;b.max=279E3;b.style.width="80%";a.append(b);b.addEventListener("input",()=>{demo.FX.Sound.audio.currentTime=b.value/1E3});demo.FX.Sound.audio.addEventListener("timeupdate",()=>{b.value=Math.round(1E3*demo.FX.Sound.audio.currentTime)});
document.addEventListener("keydown",c=>{" "==c.key&&(demo.FX.Sound.audio.paused?demo.FX.Sound.audio.play():(demo.FX.Sound.audio.pause(),demo.FX.Sound.audio.currentTime=60/85/4*(demo.FX.Sound.audio.currentTime/(60/85/4)|0)));"ArrowRight"==c.key&&(demo.FX.Sound.audio.paused||(demo.FX.Sound.audio.pause(),demo.FX.Sound.audio.currentTime=60/85/4*(demo.FX.Sound.audio.currentTime/(60/85/4)|0)),demo.FX.Sound.audio.currentTime+=60/85/4);"ArrowLeft"==c.key&&(demo.FX.Sound.audio.paused||(demo.FX.Sound.audio.pause(),
demo.FX.Sound.audio.currentTime=60/85/4*(demo.FX.Sound.audio.currentTime/(60/85/4)|0)),demo.FX.Sound.audio.currentTime-=60/85/4);"Numpad0"===c.code&&(demo.FX.Sound.audio.currentTime=0);"Numpad1"===c.code&&(demo.FX.Sound.audio.currentTime=6.5);"Numpad2"===c.code&&(demo.FX.Sound.audio.currentTime=56.5);"Numpad3"===c.code&&(demo.FX.Sound.audio.currentTime=96.5);"Numpad4"==c.code&&(demo.FX.Sound.audio.currentTime=126.5);"Numpad5"==c.code&&(demo.FX.Sound.audio.currentTime=186.5);"Numpad6"==c.code&&(demo.FX.Sound.audio.currentTime=
237.5);"Numpad7"==c.code&&(demo.FX.Sound.audio.currentTime=264.5)})}}}const demo=new Demo;
